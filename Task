<?php
include 'function.php';
include 'config.php';

if(isset($_GET['check']))
{
    $transaction_request_id = $_GET['check'];
  
    // Call verifyPayment function
    $response = verifyPayment($api_key, $email, $transaction_request_id);
    
    // Check if response is valid
    if($response !== null && isset($response->TransactionStatus))
    {
        // Check if transaction status is Completed
        if($response->TransactionStatus == 'Completed')
        {
            // Display and store variables
            $transactionStatus = $response->TransactionStatus;
            $transactionReceipt = isset($response->TransactionReceipt) ? $response->TransactionReceipt : 'N/A';
            $transactionCode = isset($response->TransactionCode) ? $response->TransactionCode : 'N/A';
            
            // Display the variables
            echo "Transaction Status: " . $transactionStatus . "<br>";
            echo "Transaction Receipt: " . $transactionReceipt . "<br>";
            echo "Transaction Code: " . $transactionCode . "<br>";
        }
        else
        {
            // Transaction status is not Completed
            echo "Unable to process the transaction. Transaction status is not Completed.";
        }
    }
    else
    {
        // Echo "unable to process the transaction" if response is invalid or empty
        echo "Unable to process the transaction. Invalid or empty response.";
    }
}
else
{
    echo "Error: No transaction ID provided.";
}
?>