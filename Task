<?php
include 'function.php';
include 'config.php';

if(isset($_GET['check']))
{
    $transaction_request_id = $_GET['check'];
  
    // Call verifyPayment function
    $response = verifyPayment($api_key, $email, $transaction_request_id);
    
    // Check if response is valid
    if($response !== null && isset($response->TransactionStatus))
    {
        // Check if transaction was cancelled
        if($response->TransactionStatus == 'Cancelled')
        {
            echo "Transaction was cancelled by the user.";
        }
        else
        {
            // Transaction is not cancelled, proceed to display details
            if(isset($response->TransactionStatus) && isset($response->TransactionReceipt) && isset($response->TransactionCode))
            {
                // Store values in variables
                $transactionStatus = $response->TransactionStatus;
                $transactionReceipt = $response->TransactionReceipt;
                $transactionCode = $response->TransactionCode;
                
                // Echo the values separately
                echo "Transaction Status: " . $transactionStatus . "<br>";
                echo "Transaction Receipt: " . $transactionReceipt . "<br>";
                echo "Transaction Code: " . $transactionCode . "<br>";
            }
            else
            {
                // Handle case where response is missing expected fields
                echo "Error: Unable to retrieve transaction details.";
            }
        }
    }
    else
    {
        // Handle case where response is invalid or empty
        echo "Error: Unable to verify transaction status.";
    }
}
else
{
    echo "Error: No transaction ID provided.";
}
?>